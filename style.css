:root{
  --bg:#0b1220; --panel:#0f172a; --panel2:#0b1229; --text:#e5e7eb; --muted:#94a3b8;
  --primary:#3b82f6; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; --border:#1f2937;
  --tile:#14224a; --tile2:#101c3c;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  background: radial-gradient(1200px 700px at 50% -10%, #1a2b57 0%, var(--bg) 60%);
  font-family: -apple-system, BlinkMacSystemFont, Inter, Roboto, "Segoe UI", Arial, sans-serif;
}

/* Top */
.topbar{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;background:var(--panel);border-bottom:1px solid var(--border)}
h1{margin:0;font-size:20px;letter-spacing:.3px}
.muted{color:var(--muted)}
.small{font-size:12px}
.controls{display:flex;gap:8px;flex-wrap:wrap}
button{
  background:#1f2937;border:1px solid var(--border);color:var(--text);
  padding:8px 12px;border-radius:10px;font-size:14px;cursor:pointer
}
button.primary{background:#2563eb}
button.secondary{background:#334155}
button.danger{background:#dc2626}
button.small{padding:5px 9px;font-size:12px}
button:disabled{opacity:.5;cursor:not-allowed}
.filelbl{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px}
.filelbl input{display:none}

/* Layout */
.layout{display:grid;grid-template-columns:340px 1fr;gap:12px;padding:12px;max-width:1300px;margin:0 auto}
@media (max-width:980px){ .layout{grid-template-columns:1fr} }

/* Cards */
.squadGrid{
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border:1px solid var(--border);border-radius:12px;padding:10px;display:grid;gap:10px
}
.card{background:var(--panel2);border:1px solid var(--border);border-radius:12px;padding:10px;display:grid;gap:8px}
.cardHeader{display:flex;justify-content:space-between;align-items:center;gap:8px}
.name{font-weight:900}
.btnRow{display:flex;gap:8px;flex-wrap:wrap}

.hpRow{display:flex;align-items:center;gap:8px}
.hpbar{flex:1;height:12px;border-radius:999px;background:#0b1229;border:1px solid #1f274f;overflow:hidden}
.hpfill{height:100%;width:100%;background:linear-gradient(90deg,#22c55e,#16a34a)}
.pill{padding:6px 10px;border-radius:999px;background:#101737;border:1px solid #1f274f;color:#cbd5e1;font-size:12px}

.avatarSm{
  width:64px;height:64px;border:1px solid var(--border);border-radius:8px;background:#0b1229 center/contain no-repeat;
  image-rendering: pixelated;
}

/* Arena */
.arena{display:grid;grid-template-rows:auto 1fr auto;gap:10px}
.field{
  position:relative;border:1px solid var(--border);border-radius:12px;overflow:hidden;min-height:380px;
  background:
    linear-gradient(90deg, var(--tile) 24px, transparent 24px) 0 0/48px 48px,
    linear-gradient(90deg, var(--tile2) 24px, transparent 24px) 0 24px/48px 48px,
    linear-gradient(0deg, var(--tile2) 24px, transparent 24px) 0 0/48px 48px,
    linear-gradient(0deg, var(--tile) 24px, transparent 24px) 24px 0/48px 48px;
}
.parallax.back{position:absolute;inset:0;background:radial-gradient(1200px 500px at 50% 0,#203b7a22,transparent);pointer-events:none}
.parallax.mid{position:absolute;inset:0;background:
  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="320" height="120"><rect width="320" height="120" fill="none"/><g fill="%2361a560" opacity="0.25"><rect x="20" y="80" width="30" height="30"/><rect x="90" y="75" width="34" height="35"/><rect x="150" y="78" width="26" height="32"/><rect x="230" y="83" width="30" height="30"/></g></svg>') repeat-x bottom/auto 100%;
  animation:pan 14s linear infinite; pointer-events:none}
@keyframes pan{from{background-position-x:0}to{background-position-x:-320px}}

.side{position:absolute;inset:0;pointer-events:none}
.left{display:flex;align-items:center;justify-content:flex-start;padding-left:7%}
.right{display:flex;align-items:center;justify-content:flex-end;padding-right:7%}

.sprite{
  width:120px;height:120px;position:relative;
  background:#0b1229 center/contain no-repeat;border:1px solid #203056;border-radius:10px;
  image-rendering: pixelated; filter:saturate(1.05) contrast(1.1);
  box-shadow:0 10px 24px rgba(0,0,0,.35);
}
.spriteLabel{position:absolute;left:50%;bottom:-28px;transform:translateX(-50%);font-size:13px;background:#101737;border:1px solid #1f274f;border-radius:999px;padding:3px 8px}
.sprite.hpLow{filter:hue-rotate(-20deg) saturate(1.2) brightness(.9)}
.sprite.dodge{animation:dodge .35s ease}
@keyframes dodge{ 0%{transform:translateX(0)} 50%{transform:translateX(28px)} 100%{transform:translateX(0)} }
.sprite.shake{animation:shake .28s ease}
@keyframes shake{ 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }

/* Slash */
.slash{
  position:absolute;width:160px;height:8px;background:linear-gradient(90deg, rgba(255,255,255,.0), rgba(255,255,255,.85), rgba(255,255,255,.0));
  left:0;top:0;transform-origin:left center;opacity:0;pointer-events:none;filter:drop-shadow(0 0 10px rgba(255,255,255,.6))
}
.slash.run{animation:slashRun .35s ease forwards}
@keyframes slashRun{
  0%{opacity:0;transform:scaleX(0.2) rotate(12deg)}
  30%{opacity:1;transform:scaleX(1) rotate(12deg)}
  100%{opacity:0;transform:translateX(160px) scaleX(1) rotate(12deg)}
}

/* Floating text */
.float{
  position:absolute;left:50%;top:20%;transform:translate(-50%,0);font-weight:900;font-size:28px;
  text-shadow:0 2px 10px rgba(0,0,0,.5);opacity:0;pointer-events:none
}
.float.show{animation:floatUp 900ms ease forwards}
.float.dmg{color:#f87171}
.float.miss{color:#93c5fd}
.float.dev{color:#fbbf24}
@keyframes floatUp{
  0%{opacity:0;transform:translate(-50%, 10px) scale(.9)}
  30%{opacity:1;transform:translate(-50%,-6px) scale(1)}
  100%{opacity:0;transform:translate(-50%,-36px) scale(1)}
}

/* HUD + log */
.hudBar{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:8px}
.status{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.actionRow{display:flex;gap:8px}
.log{border:1px solid var(--border);border-radius:12px;background:var(--panel2);padding:8px;min-height:84px;max-height:140px;overflow:auto;font-size:12px;color:#cbd5e1}

/* Overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:50;cursor:pointer}
.overlay.show{display:flex}
.flashCard{
  background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:16px 24px;min-width:360px;text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.5)
}
.flashBig{font-size:54px}
.flashSub{font-size:16px;color:#cbd5e1;margin-top:6px}

/* Spotify dock */
.spotifyDock{
  margin-top:10px; border:1px solid var(--border); border-radius:12px; background:var(--panel2); padding:10px; display:grid; gap:8px
}
.spotifyDock .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
#spotifyEmbedWrap iframe{width:100%; height:152px; border:0; border-radius:12px}

/* Settings dialog */
dialog::backdrop{background:rgba(0,0,0,.5)}
dialog{border:1px solid var(--border);border-radius:12px;background:var(--panel);color:var(--text);padding:14px}
.settings{display:grid;gap:10px;min-width:300px}
.settings .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.settings input[type="url"], .settings input[type="text"]{width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:#0b1229;color:var(--text)}
